---
import { getSession } from 'auth-astro/server';
import { getTopItems } from '../spotify/api.ts';
import { SpotifyItemType } from '../spotify/interfaces.ts';
import type { SpotifyItem, SpotifyTrack } from '../spotify/interfaces.ts';

let session = await getSession(Astro.request) as any;
if (!session) return Astro.redirect("/login");
if (!session.user) return Astro.redirect("/login");

const tracks = await getTopItems(session.accessToken, SpotifyItemType.tracks);

import Layout from '../layouts/Layout.astro';
import Track from '../components/cards/Track.astro';
---

<Layout title="//">
    <div class="flex justify-center p-10">
        <h1 class="text-4xl font-bold">Top Tracks: <span class="text-gray-300">{session.user.name}</span>
    </div>
    <div class="grid xl:grid-cols-4 md:grid-cols-2 sm:grid-cols-1 xl:gap-6 xl:gap-y-12 md:gap-12 gap-y-12 px-20 py-10">
        {
            tracks.items.map((track: SpotifyItem, index: number) => (
                <Track data={track as SpotifyTrack} rank={index+1} />
            ))
        }
    </div>
</Layout>

<script>
</script>
